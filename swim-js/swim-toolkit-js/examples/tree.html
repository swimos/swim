<!DOCTYPE html>
<html>
  <head>
    <title>Swim Tree View</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=0, shrink-to-fit=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
      html, body {
        -webkit-tap-highlight-color: transparent;
      }
    </style>
  </head>
  <body swim-theme style="display: flex; width: 100vw; height: 100vh; margin: 0;">
    <script src="../../swim-runtime-js/swim-core-js/@swim/core/dist/main/swim-core.js"></script>
    <script src="../../swim-runtime-js/swim-host-js/@swim/host/dist/main/swim-host.js"></script>
    <script src="../swim-ui-js/@swim/ui/dist/main/swim-ui.js"></script>
    <script src="../swim-ux-js/@swim/ux/dist/main/swim-ux.js"></script>
    <script>

const bodyView = swim.HtmlView.fromNode(document.body);

const containerView = swim.HtmlView.create("div")
  .position("relative")
  .flexGrow(1)
  .userSelect("none");

containerView.observe({
  viewWillResize(viewContext, view) {
    if (viewContext.viewIdiom === "desktop") {
      view.margin(60);
    } else {
      view.margin(0);
    }
  },
});

bodyView.appendChild(containerView);

const tableLayout = swim.TableLayout.fromAny({
  cols: [
    {
      key: "icon",
      shrink: 0,
      basis: 80,
      persistent: true,
    },
    {
      key: "name",
      grow: 1,
      basis: 240,
      textColor: swim.Look.color,
    },
    {
      key: "kpi1",
      optional: true,
      basis: 120,
      textColor: swim.Look.mutedColor,
    },
    {
      key: "kpi2",
      optional: true,
      basis: 120,
      textColor: swim.Look.mutedColor,
    },
    {
      key: "accessory",
      shrink: 0,
      basis: 60,
    },
  ],
});

const icon = swim.PolygonIcon.create(6);

const tableView = swim.TableView.create();
tableView.layout.setState(tableLayout);
tableView.rowHeight.setState(58);
tableView.rowSpacing.setState(2);
tableView.modifyTheme(swim.Feel.default, [[swim.Feel.primary, 1]]);

const headerView = tableView.header.injectView();
headerView.getOrCreateCol("name").label("Name");
headerView.getOrCreateCol("kpi1").label("KPI 1");
headerView.getOrCreateCol("kpi2").label("KPI 2");

const row0View = tableView.appendChild(swim.RowView);
const leaf0View = row0View.leaf.injectView();
leaf0View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf0View.appendChild(swim.TextCellView, "name").content("Row 0");
leaf0View.appendChild(swim.DisclosureCellView, "accessory");
row0View.head.injectView();
row0View.foot.injectView();
const tree0View = row0View.tree.injectView();
const header0View = tree0View.header.injectView();
header0View.getOrCreateCol("name").label("Name");
header0View.getOrCreateCol("kpi1").label("KPI 1");
header0View.getOrCreateCol("kpi2").label("KPI 2");
const row00View = tree0View.appendChild(swim.RowView);
const leaf00View = row00View.leaf.injectView();
leaf00View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf00View.appendChild(swim.TextCellView, "name").content("Row 0-0");
const row01View = tree0View.appendChild(swim.RowView);
const leaf01View = row01View.leaf.injectView();
leaf01View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf01View.appendChild(swim.TextCellView, "name").content("Row 0-1");
const row02View = tree0View.appendChild(swim.RowView);
const leaf02View = row02View.leaf.injectView();
leaf02View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf02View.appendChild(swim.TextCellView, "name").content("Row 0-2");

leaf01View.appendChild(swim.DisclosureCellView, "accessory");
row01View.head.injectView();
row01View.foot.injectView();
const tree01View = row01View.tree.injectView();
const header01View = tree01View.header.injectView();
header01View.getOrCreateCol("name").label("Name");
header01View.getOrCreateCol("kpi1").label("KPI 1");
header01View.getOrCreateCol("kpi2").label("KPI 2");
const row010View = tree01View.appendChild(swim.RowView);
const leaf010View = row010View.leaf.injectView();
leaf010View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf010View.appendChild(swim.TextCellView, "name").content("Row 0-1-0");
const row011View = tree01View.appendChild(swim.RowView);
const leaf011View = row011View.leaf.injectView();
leaf011View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf011View.appendChild(swim.TextCellView, "name").content("Row 0-1-1");

const row1View = tableView.appendChild(swim.RowView);
const leaf1View = row1View.leaf.injectView();
leaf1View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf1View.appendChild(swim.TextCellView, "name").content("Row 1");
leaf1View.appendChild(swim.DisclosureCellView, "accessory");
row1View.head.injectView();
row1View.foot.injectView();
const tree1View = row1View.tree.injectView();
const header1View = tree1View.header.injectView();
header1View.getOrCreateCol("name").label("Name");
header1View.getOrCreateCol("kpi1").label("KPI 1");
header1View.getOrCreateCol("kpi2").label("KPI 2");
const row10View = tree1View.appendChild(swim.RowView);
const leaf10View = row10View.leaf.injectView();
leaf10View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf10View.appendChild(swim.TextCellView, "name").content("Row 1-0");
const row11View = tree1View.appendChild(swim.RowView);
const leaf11View = row11View.leaf.injectView();
leaf11View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf11View.appendChild(swim.TextCellView, "name").content("Row 1-1");
const row12View = tree1View.appendChild(swim.RowView);
const leaf12View = row12View.leaf.injectView();
leaf12View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf12View.appendChild(swim.TextCellView, "name").content("Row 1-2");
const row13View = tree1View.appendChild(swim.RowView);
const leaf13View = row13View.leaf.injectView();
leaf13View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf13View.appendChild(swim.TextCellView, "name").content("Row 1-3");

leaf12View.appendChild(swim.DisclosureCellView, "accessory");
row12View.head.injectView();
row12View.foot.injectView();
const tree12View = row12View.tree.injectView();
const header12View = tree12View.header.injectView();
header12View.getOrCreateCol("name").label("Name");
header12View.getOrCreateCol("kpi1").label("KPI 1");
header12View.getOrCreateCol("kpi2").label("KPI 2");
const row120View = tree12View.appendChild(swim.RowView);
const leaf120View = row120View.leaf.injectView();
leaf120View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf120View.appendChild(swim.TextCellView, "name").content("Row 1-2-0");
const row121View = tree12View.appendChild(swim.RowView);
const leaf121View = row121View.leaf.injectView();
leaf121View.appendChild(swim.IconCellView, "icon").iconWidth(40).graphics(icon);
leaf121View.appendChild(swim.TextCellView, "name").content("Row 1-2-1");

containerView.appendChild(tableView);

function updateMood(view) {
  const warnThreshold = 0.8;
  const alertThreshold = 0.95;
  let u = Math.random();
  if (u < warnThreshold) {
    view.modifyMood(swim.Feel.default, [[swim.Feel.warning, void 0], [swim.Feel.alert, void 0]]);
  } else if (u < alertThreshold) {
    u = (u - warnThreshold) / (alertThreshold - warnThreshold);
    u = 0.6 + 0.4 * u;
    view.modifyMood(swim.Feel.default, [[swim.Feel.warning, 1], [swim.Feel.alert, void 0]]);
  } else {
    u = (u - alertThreshold) / (1 - alertThreshold);
    u = 0.6 + 0.4 * u;
    view.modifyMood(swim.Feel.default, [[swim.Feel.warning, void 0], [swim.Feel.alert, u]]);
  }
}
function updateMoods() {
  updateMood(leaf0View);
  updateMood(leaf00View);
  updateMood(leaf01View);
  updateMood(leaf010View);
  updateMood(leaf011View);
  updateMood(leaf02View);
  updateMood(leaf1View);
  updateMood(leaf10View);
  updateMood(leaf11View);
  updateMood(leaf12View);
  updateMood(leaf120View);
  updateMood(leaf121View);
  updateMood(leaf13View);
}
setInterval(updateMoods, 4000);
updateMoods();

//setTimeout(function () {
//  const timing = swim.Easing.cubicOut.withDuration(2000);
//  row0View.disclosure.expand(timing);
//  row01View.disclosure.expand(timing);
//  row1View.disclosure.expand(timing);
//  row12View.disclosure.expand(timing);
//  setInterval(function () {
//    row0View.disclosure.toggle(timing);
//    row1View.disclosure.toggle(timing);
//  }, 3000);
//}, 1000);

    </script>
  </body>
</html>
